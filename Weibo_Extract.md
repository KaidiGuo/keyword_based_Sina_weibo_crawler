# å‰è¨€

ç®€å•ä»‹ç»ä¸€ä¸‹æˆ‘å†™ç”¨è¿™ä¸ªçˆ¬è™«æƒ³åšçš„é¡¹ç›®æ˜¯ä»€ä¹ˆæ ·çš„.
æˆ‘æ—¨åœ¨åˆ†æä¸­å›½å¾®åšç”¨æˆ·å¯¹ä¸åŒå›½å®¶æ–°é—»&ä¿¡æ¯çš„å…³æ³¨ç¨‹åº¦æ¥äº†è§£æ°‘é—´æ–¹å‘ä¸Šçš„æˆ‘å›½å›½é™…å…³ç³»: **ä¸­å›½ç½‘æ°‘æ˜¯å¦‚ä½•çœ‹å¾…å…¨ä¸–ç•Œå…¶ä»–å›½å®¶çš„ï¼Œå…³æ³¨ç‚¹åœ¨å“ªé‡Œ.**
åŒæ—¶ç”¨è·å¾—çš„æ•°æ®åˆ¶ä½œä¸€ä¸ªå¯äº¤äº’çš„å¯è§†åŒ–å¾®åšåˆ†æç»“æœ.

æ‰€ä»¥æˆ‘ä»¥193ä¸ª[è”åˆå›½ä¼šå‘˜å›½](https://zh.wikipedia.org/wiki/%E5%9B%BD%E5%AE%B6%E5%88%97%E8%A1%A8_(%E6%8C%89%E6%B4%B2%E6%8E%92%E5%88%97))åŠ ä¸¤ä¸ªè”åˆå›½è§‚å¯Ÿå‘˜å›½:æ¢µè’‚å†ˆï¼Œå·´å‹’æ–¯å¦, 
å»æ‰ä¸­å›½åçš„ä¸€å…±194ä¸ªå›½å®¶ä¸ºæŸ¥è¯¢åˆ—è¡¨.
ï¼ˆåŸºäºä¸ªäººå…´è¶£æˆ‘åœ¨åˆ—è¡¨ä¸­ä¹ŸåŠ å…¥äº†â€œå°æ¹¾â€ä¸ºå…³é”®è¯ï¼Œä½†æ˜¯å½“ç„¶æŠŠå°æ¹¾è®¤å®šä¸ºä¸€ä¸ªç‹¬ç«‹å›½å®¶å¹¶ä¸æ˜¯æ­£ç¡®çš„ï¼Œæ‰€ä»¥æˆ‘å¹¶ä¸ä¼šåœ¨è®ºæ–‡å’Œå¯è§†åŒ–è¿‡ç¨‹ä¸­ç”¨åˆ°æ¥è‡ªå°æ¹¾çš„æ•°æ®ï¼‰
å†™äº†ä¸€ä¸ªéå¸¸ç®€å•çš„å°çˆ¬è™«ï¼Œé€šè¿‡é€šè¿‡[ç§»åŠ¨ç‰ˆå¾®åš](http://m.weibo.cn/p/100103type%3D2%26q%3D%E5%BE%B7%E5%9B%BD?type=wb&queryVal=%E5%BE%B7%E5%9B%BD&luicode=10000011&lfid=106003type%3D1&title=%E5%BE%B7%E5%9B%BD)**æœç´¢å¾®åš**åŠŸèƒ½çˆ¬å–æŒ‰ç…§è¿™ä¸ªå›½å®¶åˆ—è¡¨æŸ¥è¯¢åˆ°çš„å¾®åš.

# What I got

å·²è·å–çš„å¾®åšJSONæ•°æ®æŒ‰ç…§requestå‘èµ·çš„æ—¥æœŸåˆ†åˆ«å­˜åœ¨ç›¸åº”çš„æ–‡ä»¶å¤¹å†…éƒ¨ã€‚WBTestdata>04-12.

![å¾®åšæ•°æ®æ–‡ä»¶å¤¹](http://upload-images.jianshu.io/upload_images/42676-240c3aee71891a4f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

æ¯ä¸€é¡µJSONåŒ…å«åæ¡å¾®åšæ•°æ®ï¼ˆä¸€èˆ¬æƒ…å†µï¼‰ï¼Œå°†æ¯æ¬¡è¿”å›çš„JSONå•è°ƒå­˜åœ¨ä¸€ä¸ªtxté‡Œï¼Œå‘½åè§„åˆ™ä¸ºâ€œå›½å®¶åâ€+â€œæ—¥æœŸâ€+â€œé¡µç â€.

![å¾®åšæ•°æ®å‘½åè§„åˆ™](http://upload-images.jianshu.io/upload_images/42676-a97b05ccb71dba86.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

å¯ä»¥ä½¿ç”¨åœ¨çº¿[JSONç»“æ„åŒ–å·¥å…·](http://www.jsoneditoronline.org/)è¿›è¡Œå®¡æŸ¥ã€‚

# è½½å…¥æ•°æ®

å› ä¸ºæˆ‘çš„æ•°æ®æ˜¯åŒ…å«æ—¥æœŸçš„ï¼Œè¿™å°±ä½¿å¾—æˆ‘å¯ä»¥è½½å…¥æŒ‡å®šæ—¥æœŸå†…çš„æ•°æ®.
ä¸ºæ­¤ï¼Œæˆ‘å…ˆå†™äº†ä¸€ä¸ªæ ¹æ®ç»™å‡ºèµ·å§‹æ—¥æœŸç”Ÿæˆæ—¥æœŸåˆ—è¡¨çš„æ–¹æ³•ï¼š
```
def creat_date_list(month,i,j):
    dates = []
    for n in range(i,j):
        date = month + "-" +str(n).zfill(2)
        dates.append(date)
    return dates
```
åœ¨è°ƒç”¨çš„æ—¶å€™ä¾‹å¦‚`dateList = creat_date_list("04",27,28)`å°±ä¼šäº§ç”Ÿåªæœ‰ä¸€ä¸ªå€¼çš„åˆ—è¡¨.
ç„¶åï¼ŒæŒ‰ç…§listçš„å†…å®¹ç”Ÿæˆæ–‡ä»¶å¤¹åœ°å€ï¼Œæ£€æŸ¥æ­¤æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨åˆ™å¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥çš„æ–‡ä»¶éå†äº†.
```
for date in dateList:
    thisDate = date
    datapath = "../WBTestdata/" + thisDate + "/"
    if os.path.exists(datapath):
        print "got data"
    else:
        print "Did not find this dayÂ´s data, next day!!"
        time.sleep(5)
        continue
```
å½“å‡†ç¡®è·å–åˆ°å­˜æ”¾å¾®åšå…ƒæ•°æ®çš„æ–‡ä»¶å¤¹è·¯å¾„äº†ä»¥åï¼Œæˆ‘ä»¬é¢å¯¹çš„æ˜¯ä¸Šç™¾ä¸ªtxt.
éå†å®ƒä»¬ï¼Œæå–æˆ‘æƒ³è¦çš„é‚£å‡ ä¸ªå±æ€§å†…å®¹ï¼Œå†æŒ‰ç…§ä¸€å®šçš„è§„åˆ™å†™å…¥æ–°çš„txt.
æ•°æ®é‡åœ¨æå–è¿‡åå¿…ç„¶ä¼šå˜å¾—å°å¾ˆå¤šï¼Œé‚£æˆ‘å¸Œæœ›å°†æŸä¸€å¤©requeståˆ°çš„æ‰€æœ‰å¾®åšå†™å…¥ä¸€ä¸ªæ–°çš„ï¼Œå•ä¸€çš„ï¼Œä»¥å½“å¤©æ—¥æœŸå‘½åçš„txt.
æ‰€ä»¥ï¼Œæˆ‘çš„è¾“å‡ºè·¯å¾„å’Œæ–‡ä»¶åå°±å¾ˆå¥½è§„åˆ’äº†ï¼Œæˆ‘å°†è¾“å‡ºæ•°æ®å­˜æ”¾åœ¨ä¸€ä¸ªå«åšWBDatabaseçš„æ–‡ä»¶å¤¹å†…ï¼Œå› ä¸ºç›®å‰çš„è¾“å‡ºtxtæ•°æ®æ˜¯æ ¹æ®æ—¥æœŸå‘½åå’Œåˆ†å‰²çš„ï¼Œæ‰€ä»¥å†ä¸¢è¿›ä¸€ä¸ªå«timeçš„æ–‡ä»¶å¤¹ï¼š
```
outputPath = "../WBDatabase/time/"
    if not os.path.exists(outputPath):
        os.mkdir(outputPath)
    outputFile = outputPath + thisDate + ".txt"
    with open(outputFile, "a") as output:
        output.write("\n")
```
åœ¨è¿™é‡Œï¼Œæˆ‘åœ¨æ–‡ä»¶å¼€å¤´çš„ç¬¬ä¸€è¡Œå†™äº†ä¸€ä¸ªæ¢è¡Œç¬¦æ˜¯å› ä¸ºå½“è½½å…¥txtæ–‡ä»¶è¿›MYSQLæ•°æ®åº“çš„æ—¶å€™ï¼Œç¬¬ä¸€è¡Œå‡ºç°äº†ä¸€äº›æ— æ³•è¯†åˆ«æ•°æ®çš„é”™è¯¯ï¼Œæ‰€ä»¥æˆ‘å°†è¿™ä¸€è¡Œç©ºå‡ºï¼Œå†åœ¨æ•°æ®å¯¼å…¥åä»æ•°æ®åº“ä¸­åˆ æ‰è¿™ä¸€ç©ºç™½è¡Œ.

æ¥ä¸‹æ¥å›åˆ°åˆšè¯´çš„éå†æ–‡ä»¶å¤¹.
`os.walk(datapath)`æ–¹æ³•å¯ä»¥å®ç°å¿«é€Ÿçš„æ–‡ä»¶å¤¹å†…éƒ¨éå†.
åœ¨è¿™é‡Œé€šè¿‡æ–‡ä»¶åè·å–åˆ°çš„`thisCountry`å°±æ˜¯æˆ‘ä»¬æœ¬æ¡å¾®åšçš„keyword.
æ³¨æ„ï¼Œä¸­æ–‡çš„ç¼–ç è½¬æ¢éå¸¸å¤æ‚ï¼Œéœ€è¦ä»”ç»†è€å¿ƒ.
```
list_dirs = os.walk(datapath)
    for root, dirs, files in list_dirs:
        for f in files:
            filename = f.decode("gbk").encode("UTF-8")
            thisfilepath = datapath + filename.decode("UTF-8")
            thisCountry = filename.split(thisDate)[0].decode("UTF-8")
```
é€šè¿‡éå†æ–‡ä»¶å¤¹è·å–åˆ°æ–‡ä»¶ååï¼Œå°±å¯ä»¥æ‰“å¼€æŒ‡å®šçš„txtæ–‡ä»¶è¿›è¡ŒJSONè£…è½½äº†.
```
with codecs.open(thisfilepath, "r", "utf-8") as thisfile:
        content = thisfile.read()
        thisdata = json.loads(content)
```
è£…è½½å®ŒJSONï¼Œæ¥ä¸‹æ¥å³å¯è¿›è¡Œå¾®åšç›¸å…³æ•°æ®çš„æå–.
# å¾®åšæ•°æ®æå–æ€è·¯

JSONç»“æ„éå¸¸æ¸…æ¥šï¼Œæˆ‘è§‰å¾—æœ‰ç”¨çš„å¾®åšå±æ€§ï¼š
* æ•°æ®å¾®åšID
* å¾®åšåˆ›å»ºæ—¶é—´
* å¾®åšè½¬å‘æ•° 
* å¾®åšå‘å¸ƒå¹³å°
* å¾®åšç”¨æˆ·å
* å¾®åšç”¨æˆ·ID
* å¾®åšç”¨æˆ·æ€§åˆ«
* å¾®åšç”¨æˆ·ç²‰ä¸æ•°
* å¾®åšå†…å®¹

åˆ†åˆ«å¯ä»¥ç”¨ä»¥ä¸‹ä»£ç æ¥è¡¨ç¤ºå’Œæå–.
```
itemID = str(thisdata['cards'][0]['card_group'][i]['mblog']['id'])
itemCreat = thisdata['cards'][0]['card_group'][i]['mblog']['created_at'].encode("UTF-8")
itemRepostCount = str(thisdata['cards'][0]['card_group'][i]['mblog']['reposts_count'])
itemSource = puncfilter(thisdata['cards'][0]['card_group'][i]['mblog']['source'])
itemUser = thisdata['cards'][0]['card_group'][i]['mblog']['user']['screen_name']
itemUserID = str(thisdata['cards'][0]['card_group'][i]['mblog']['user']['id'])
itemUserGender = str(thisdata['cards'][0]['card_group'][i]['mblog']['user']['gender'])
itemUserFollower = str(thisdata['cards'][0]['card_group'][i]['mblog']['user']['followers_count'])
itemText = thisdata['cards'][0]['card_group'][i]['mblog']['text']
```
æå–äº†ä»¥ä¸Šä¿¡æ¯ä»¥åï¼Œè¿˜è¦å¯¹å¯¹å¾®åšæ–‡æœ¬è¿›è¡Œå…³é”®è¯æ¡çš„Tagæå–ã€‚æ­¤å¤„å°†ä¼šç”¨åˆ°[ç»“å·´åˆ†è¯](https://github.com/fxsjy/jieba).

å‰é¢æåˆ°äº†ï¼Œä¸ºäº†å¯¼å…¥MYSQLæ–¹ä¾¿ï¼Œä½†åŒæ—¶åˆä¿ç•™åŸæ•°æ®ï¼Œæˆ‘å°†ä¼šæŠŠæ¯ä¸€æ¡å¾®åšæå–åˆ°çš„ç›¸å…³æ•°æ®ç»„æˆä¸€è¡Œï¼Œå­˜åœ¨æ–°çš„ä»¥æ—¥æœŸå‘½åçš„txtä¸­.
æ¯ä¸€è¡Œï¼Œæ—¢æ¯ä¸€æ¡å¾®åšï¼Œå…¶æ¯ä¸€ä¸ªå±æ€§é—´ç”¨tabåˆ†å‰²ï¼ˆMYSQLå¯¼å…¥æ—¶å°†ä»¥\tä¸ºåˆ†éš”ç¬¦ï¼‰ï¼Œæœ€åçš„tagå±æ€§æˆ‘å–äº†5ä¸ªè¯ï¼Œç”¨ç©ºæ ¼åŒºåˆ†.
```
0		Staunch17	5985880084	123	f	åœ¨çˆ±çš„å›½åº¦ï¼Œæˆ‘å”¯ä¸€çˆ±çš„ï¼Œå°±æ˜¯ä½ è‡´æ•¬ä¸ä¸¹ï¼Œè¿™æ˜¯ä¸€ä¸ªå……æ»¡å¹¸ç¦æ„Ÿçš„å›½å®¶ â€‹	 å¹¸ç¦æ„Ÿ å›½åº¦ ä¸ä¸¹ è‡´æ•¬ å……æ»¡
```
ç›¸åº”çš„MYSQLæ•°æ®è¡¨åˆ›å»ºè¯­å¥åˆ™ä¸ºï¼š
```
CREATE TABLE wbdata (	
    creat_at DATETIME NOT NULL,
    keyword VARCHAR(30) NOT NULL,
    wid BIGINT NOT NULL,
    repost INT NOT NULL,
    platform CHAR(35) ,
    user CHAR(45) NOT NULL,
    uid INT NOT NULL,
    follower INT NOT NULL,
    gender VARCHAR(2),
    text VARCHAR(500),
    tags VARCHAR(500)

) character set = utf8mb4 COLLATE = utf8mb4_unicode_ci;
```
keywordå±æ€§å³æ˜¯å‰é¢è·å–åˆ°çš„`thisCountry`å›½å®¶å.

# æ•°æ®è¿‡æ»¤ç»†èŠ‚

åœ¨æ€è·¯æ¸…æ™°äº†ä»¥åå°±å¯ä»¥ç€æ‰‹äºç»†èŠ‚çš„å¤„ç†äº†ã€‚
è¿™é‡Œæˆ‘ä»¬æœ‰ä»¥ä¸‹å‡ ä¸ªé—®é¢˜éœ€è¦è¿›è¡Œå¤„ç†ï¼Œ
1. æ¯æ¡å¾®åšçš„åˆ›å»ºæ—¶é—´éœ€è¦ç”±è®¿é—®æ—¶é—´æ¥è¿›è¡Œæ¨ç®—å¹¶è¿›è¡Œç»Ÿä¸€åŒ–
2. å¾®åšä¸­å¯èƒ½å‡ºç°HTMLæ ‡ç­¾ï¼Œæ¢è¡Œæ ‡ç­¾ç­‰éœ€è¦è¿›è¡Œæ‘˜é™¤
3.  å¾®åšæ–‡æœ¬ä¸­å‡ºç°çš„å¤§é‡è¡¨æƒ…ç¬¦å·éœ€è¦è¢«åˆæ­¥è¿‡æ»¤
4.  å¾®åšå‡ºç°çš„å¤šäººè¿ç»­@éœ€è¦å‰”é™¤
5. å¾®åšå‘å¸ƒå¹³å°ä¿¡æ¯ä¹ŸåŒ…å«ç”¨æˆ·è‡ªå®šä¹‰æ•°æ®ï¼Œéœ€è¦è§„èŒƒåŒ–



#### æ—¶é—´æ ¼å¼è½¬æ¢
å¯¹äºç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œå½“çŸ¥é“æœ¬æ¬¡requestçš„æ—¶é—´æˆ³ä»¥åï¼Œå°±å¯ä»¥é€šè¿‡æ¢ç®—å¾—åˆ°æ¯ä¸€æ¡å¾®åšåˆ›å»ºçš„æ—¶é—´äº†.
æœ¬æ¬¡requestçš„æ—¶é—´æˆ³åœ¨JSONé‡Œçš„ä½ç½®ä¸ºï¼š
```
thisdata['cardlistInfo']['starttime']
```
å¯¹äºå…ƒæ•°æ®ä¸­creat_atå±æ€§ï¼Œå€¼ä¸€èˆ¬ä¸ºä¸‰ç§ç»“æ„ï¼šâ€œ04-16 20:00â€ï¼Œ â€œ3åˆ†é’Ÿå‰â€ï¼Œ â€œä»Šå¤© 20:00â€.
æ ‡å‡†æ—¶é—´æ ¼å¼è¿˜åº”å½“æœ‰ç§’ï¼Œæ‰€ä»¥åœ¨å¤„ç†çš„æ—¶å€™åº”å½“åŠ å…¥ç¼ºå¤±éƒ¨åˆ†é»˜è®¤ä¸º00ç§’.
åœ¨è¿™é‡Œè¦æ³¨æ„ä¸€ä¸‹ï¼Œlocaltimeè½¬æ¢é»˜è®¤è·Ÿç€è®¡ç®—æœºæ—¶é—´èµ°ï¼Œå› ä¸ºæˆ‘ä¸åœ¨å›½å†…ï¼Œæ‰€ä»¥æ—¶åŒºä¸ä¸€æ ·ï¼Œç®—å‡ºæ¥çš„å¾®åšå‘å¸ƒæ—¶é—´é”™äº†6ä¸ªå°æ—¶ï¼Œæ²¡æœ‰ä»€ä¹ˆè½¬æ¢æ—¶åŒºçš„å¥½åŠæ³•ï¼Œæˆ‘å°±ç›´æ¥æŠŠæˆ‘ç”µè„‘ç³»ç»Ÿçš„é»˜è®¤æ—¶åŒºè°ƒæˆäº†ä¸­å›½æ—¶é—´.
ä½†æ˜¯ç†è®ºä¸Šå“ªæ€•é”™äº†6ä¸ªå°æ—¶ä¹Ÿå½±å“ä¸å¤§ï¼Œå› ä¸ºæˆ‘çš„æ¯æ—¥çƒ­ç‚¹åˆ†æç»Ÿè®¡ä»¥åŠåé¢çš„å¯è§†åŒ–éƒ½åº”å½“æ˜¯æŒ‰ç…§å¤©ä¸ºå•ä½çš„.
```
def process_time(input, starttime):
    if "ä»Šå¤©" in input:
        thisStartTime = time.localtime(float(starttime))
        otherStyleTime = str(time.strftime("%Y-%m-%d", thisStartTime))
        creatTime = otherStyleTime + " " + input.split(" ")[1]+":00"
        return creatTime
    elif "åˆ†é’Ÿå‰" in input:
        creatTime = 60 * float(input.strip("åˆ†é’Ÿå‰"))
        thisStartTime = time.localtime(float(starttime) - creatTime)
        otherStyleTime = str(time.strftime("%Y-%m-%d %H:%M:%S", thisStartTime))
        return otherStyleTime
    else:
        return "2017-"+input+":00"
```
#### æ–‡æœ¬ä¸­HTMLæ ‡ç­¾å»é™¤
åˆæ­¥æå–çš„å¾®åšæ–‡æœ¬åŒ…å«HTMLæ ‡ç­¾.

![åŒ…å«HTMLçš„å¾®åšæ–‡æœ¬](http://upload-images.jianshu.io/upload_images/42676-e1415e327a5e2e7a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

éœ€è¦è¿›è¡Œå†æ¬¡æå–.
è¿™é‡Œç”¨åˆ°[Beautifulsoup](https://www.crummy.com/software/BeautifulSoup/bs4/doc.zh/).
å®ƒæ˜¯ä¸€ä¸ªå¯ä»¥ä»HTMLæˆ–XMLæ–‡ä»¶ä¸­æå–æ•°æ®çš„Pythonåº“.
ä»¥ä¸‹ä»£ç å¯ä»¥æŠŠè¾“å…¥å…ƒæ–‡æœ¬ä¸­çš„æ‰€æœ‰tagé‡Œçš„å†…å®¹æå–å‡ºæ¥å¹¶è·³è¿‡ç©ºç™½è¡Œï¼Œè¾“å‡ºå½¢å¼ä¸ºåˆ—è¡¨.
ä½†æ˜¯å½“ç„¶å®ç°åŠæ³•æœ‰å¾ˆå¤šï¼ŒB4Sæä¾›äº†è®¸å¤šå…¶ä»–å¯èƒ½çš„æ–¹å¼.
```
from bs4 import BeautifulSoup

soup = BeautifulSoup(itemText, "html.parser")
itemTextPretty = ""
for string in soup.stripped_strings:
     itemTextPretty += string
```
ç„¶åæ˜¯å»æ‰æ–‡æœ¬ä¸­çš„URLå’Œè¿ç»­@.
ä¸¤ä¸ªç®€å•çš„å°æ–¹æ³•æ¥å®ç°.
```
itemTextPretty = removepeople(itemTextPretty)
itemTextPretty = removeurl(itemTextPretty)
```
```
def removeurl(urlline):
    results = re.compile(r'http://[a-zA-Z0-9.?/&=:]*', re.S)
    dd = results.sub("", urlline)
    return dd

def removepeople(peopleline):
    pattern = peopleline.split("//@")
    outputline = ""
    for name in pattern:
        name = name.split(":")[-1]
        outputline += name
    return outputline
```
æ¥ä¸‹æ¥æ˜¯ç²—æ­¥è¿‡æ»¤æ‰ä¸€äº›æ ‡ç‚¹ç¬¦å·.
```
def puncfilter(line):  
    r1 = u'[â€™!"#$%&\'()*+,-./:;<=>?@ï¼›ï¼›ï¼šï¼ï½œï½\â‰§â–½â€”Â°â„Ã—ğŸ€ğŸ¾ğŸ“ğŸ‹â–²â™¥â™€â˜€â—å·œã€Œã€â˜•ï¼â†“â†’<=>?@â„â€¢Ï‰â˜…ğŸ’ŠğŸ™ˆâ˜•ğŸ’°ğŸ˜‚Â·ã€â€¦â˜…ã€â€‹â€¦ã€ã€‘ã€Šã€‹ã€ã€ï¼ˆï¼‰ï¼Ÿâ€œâ€â€˜â€™ï¼[\\]^_`{|}~]+'
    return re.sub(r1, '', line)
```
è¿‡æ»¤å®Œä»¥åå°±å¯ä»¥è¿›è¡Œç»“å·´åˆ†è¯çš„Tagæå–äº†ï¼š
åœ¨è¿™é‡Œ`topk=5`è§„å®šäº†æå–é‡è¦æ€§å‰äº”çš„å•è¯.
å› ä¸ºç»“å·´åˆ†è¯æ–¹æ³•è¿”å›çš„æ˜¯ä¸€è¿ä¸²tupeï¼Œæ¯ä¸€ä¸ªtupeé‡Œçš„ç¬¬ä¸€ä½ä¸ºè¯è¯­ï¼Œç¬¬äºŒä½ä¸ºé‡è¦å€¼ï¼Œæˆ‘åªéœ€è¦è¯ï¼Œæ‰€ä»¥ç”¨foræ–¹æ³•æå–ï¼Œèµ‹å€¼ç»™extraclineä»¥ç©ºæ ¼åˆ†å‰².
```
extract = jieba.analyse.extract_tags(itemTextP, topK=5, withWeight=True, allowPOS=())
extractline = ""
for word in extract:
    co = word[0]
    extractline = extractline + " " + co
```
#### å¾®åšå‘å¸ƒå¹³å°çš„è§„èŒƒåŒ–
é‚£ä¹ˆï¼Œé™¤äº†å¾®åšæ–‡æœ¬è¦è¿›è¡Œç¬¦å·è¿‡æ»¤ä¹‹å¤–ï¼Œç”¨æˆ·å‘å¸ƒå¹³å°ä¹Ÿéœ€è¦ï¼Œå› ä¸ºå¾®åšç”¨æˆ·å¯ä»¥è‡ªå·±ä¿®æ”¹å‘å¸ƒå¹³å°çš„åŸå› ï¼Œæ”¶é›†åˆ°çš„å¾ˆå¤šå¹³å°ä¿¡æ¯ä¸ºç´¯èµ˜ä¿¡æ¯ï¼š

![å¾®åšå‘å¸ƒå¹³å°ä¸­çš„ç´¯èµ˜ä¿¡æ¯](http://upload-images.jianshu.io/upload_images/42676-41401bfd178c7fb0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

æˆ‘è¦å»é™¤è¿™äº›ç”¨æˆ·è‡ªå®šä¹‰çš„éƒ¨åˆ†ï¼Œå¯¹äºiphoneç”¨æˆ·ï¼Œæˆ‘ç›´æ¥å»ºäº†å¼ å‹å·è¡¨è¿›è¡ŒåŒ¹é…ã€‚
è€Œå¯¹äºåƒæ˜¯çº¢ç±³è¿™æ ·çš„æƒ…å†µï¼Œä¸ºäº†ä¾¿äºåæœŸç»Ÿè®¡ï¼Œæˆ‘åŠ å…¥å°ç±³å‰ç¼€ï¼ŒåŒç†è¿˜æœ‰é­…è“ï¼ŒåŠ å…¥é­…æ—å‰ç¼€ï¼Œè£è€€åŠ å…¥åä¸ºå‰ç¼€ã€‚
ä½†æ˜¯å½“ç„¶ï¼Œèƒ½å…¼é¡¾åˆ°çš„ä¹Ÿåªæ˜¯å¤§éƒ¨åˆ†ç”¨æˆ·è€Œå·²ï¼Œè¿‡äºå°ä¼—çš„ä¸€äº›æ‰‹æœºçš„æŸäº›å‹å·åˆ™æ— æ³•åšåˆ°ç™¾åˆ†ç™¾çš„è§„èŒƒåŒ–ã€‚
```
def platformUni(platform):
    if 'iPhone' in platform:
        iphonelist =[ "iPhone 5s", "iPhone 5c", "iPhone 5",  "iPhone 6 Plus", "iPhone 6s Plus", "iPhone 6s","iPhone 6", "iPhone 7 Plus", "iPhone 7","iPhone SE", "iPhone"]
        for phone in iphonelist:
            if phone in platform:
                new = phone
                return new
        # new = "iPhone" + platform.split('iPhone')[1]
    elif 'iOS' in platform:
        new = "iPhone"
        return new
    elif 'Android' in platform:
        new = "Android" + platform.split('Android')[1]
        return new
    elif 'iPad' in platform:
        new = "iPad" + platform.split('iPad')[1]
        return new
    elif '360æ‰‹æœº' in platform:
        new = "360æ‰‹æœº"
        return new
    elif 'é­…æ—' in platform:
        new = "é­…æ—" + platform.split('é­…æ—')[1]
        return new
    elif 'MEIZU' in platform:
        new = "é­…æ—" + platform.split('MEIZU')[1]
        return new
    elif 'é­…è“' in platform:
        new = "é­…æ— é­…è“" + platform.split('é­…è“')[1]
        return new
    elif 'Galaxy' in platform:
        new = "ä¸‰æ˜Ÿ Galaxy" + platform.split('Galaxy')[1]
        return new
    elif 'GALAXY' in platform:
        new = "ä¸‰æ˜Ÿ Galaxy" + platform.split('GALAXY')[1]
        return new
    elif 'Samsung' in platform:
        new = "ä¸‰æ˜Ÿ" + platform.split('Samsung')[1]
        return new
    elif '360' in platform:
        new = "360" + platform.split('360')[1]
        return new
    elif 'å°ç±³' in platform:
        new = "å°ç±³" + platform.split('å°ç±³')[1]
        return new
    elif 'çº¢ç±³' in platform:
        new = "å°ç±³ çº¢ç±³" + platform.split('çº¢ç±³')[1]
        return new
    elif 'xiaomi' in platform:
        new = "å°ç±³" + platform.split('å°ç±³')[1]
        return new
    elif 'è£è€€' in platform:
        new = "åä¸ºè£è€€" + platform.split('è£è€€')[1]
        return new
    elif 'vivo' in platform:
        new = "vivo" + platform.split('vivo')[1]
        return new
    elif 'HUAWEI' in platform:
        new = "åä¸º" + platform.split('HUAWEI')[1]
        return new
    elif 'OnePlus' in platform:
        new = "ä¸€åŠ " + platform.split('OnePlus')[1]
        return new
    elif 'Smartisan' in platform:
        new = "é”¤å­" + platform.split('Smartisan')[1]
        return new
    elif 'åšæœ' in platform:
        new = "é”¤å­ åšæœ" + platform.split('åšæœ')[1]
        return new
    elif 'Xperia' in platform:
        new = "ç´¢å°¼ Xperia" + platform.split('Xperia')[1]
        return new
    else:
        return platform
```
è§„èŒƒåŒ–æ˜¯ä¸€æ–¹é¢ï¼Œä½†æ˜¯ä»‹äºåæœŸæˆ‘å¯èƒ½ä¼šéœ€è¦ç»Ÿè®¡ä¸åŒå“ç‰Œçš„æ‰‹æœºå‹å·å æ¯”ï¼Œæˆ‘åœ¨è¿™é‡Œå°±ç›´æ¥å†æ·»åŠ äº†ä¸€ä¸ªå±æ€§æ®µï¼Œå³æŠŠå‘å¸ƒå¹³å°è¿›è¡Œç¬¼ç»Ÿåˆ†ç±»ï¼Œæ‰€æœ‰iphoneçš„å„ç§å‹å·éƒ½å½’ä¸ºä¸€ç±»ï¼Œæ‰€æœ‰ä¸‰æ˜Ÿæ‰‹æœºå½’ä¸ºä¸‰æ˜Ÿç±»è¿™æ ·.
```
def platformSimp(platform):
    platformlist = ["iPhone", "iPad", "ç§’æ‹", "ä¸‰æ˜Ÿ", "åä¸º", "å°ç±³", "OPPO", "vivo", "é­…æ—","ç´¢å°¼","é”¤å­","ä¸€åŠ ","Android"]
    thisphone = platform
    for phone in platformlist:
        if phone in platform:
            return phone
    return platform
```


#### å†™è¡Œ
åœ¨åšå®Œè¿™ä¸€åˆ‡ä»¥åï¼Œå°±å¯ä»¥æŠŠå±æ€§æŒ‰é¡ºåºç»„æˆä¸€è¡Œå†™å…¥äº†.
```
 dataLine = itemCreatFormat + "\t" + itemKeyword.encode("UTF-8") + "\t" + str(itemID)  + "\t" + str(itemRepostCount) + "\t" + itemSourceUni + "\t" + itemSourceSimp + "\t" +itemUser.encode("UTF-8") + "\t" + str(itemUserID) + "\t" + str(itemUserFollower) + "\t" + itemUserGender + "\t" +itemTextP.encode("UTF-8")+ "\t"+ extractline.encode("UTF-8") + '\n'
                        
```
æœ€ç»ˆç»“æœå¦‚ä¸‹ï¼š

![è¾“å‡ºç»“æœ](http://upload-images.jianshu.io/upload_images/42676-42873661df77c15c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

è¿™ä¸ªæ–‡æœ¬æ–‡ä»¶å°±å¯ä»¥å¾ˆè½»æ¾çš„å¯¼å…¥mysqlè¿›è¡Œä¸‹ä¸€æ­¥çš„å»é‡ï¼Œåˆ†æç­‰æ“ä½œäº†.
